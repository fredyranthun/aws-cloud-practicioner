# IAM - Identity and Access Management

- It is a global service
- By default, the root account is created and must be used only for setting up the other accounts
- Users are people in your organization and they can be grouped
- Groups contain only users, not other groups
- Users do not have to belong to groups, and can be belong to more than one group
- users and groups can be assigned JSON documents called Policies

## Policy example

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:Describe*",
      "Resource": "*"
    }
  ]
}
```

- defines the permissions of the users
- can allow users or groups to do certain actions
- in AWS you apply the least privilege principle: don't give more permission than one needs

- when attaching a policy to a group, it is attached to the users whithin that group
- generally this way is more recommended

## Creating a new user

- to login, use the url of the account (can use with an alias)
- attach the Administrator policies to a group, and then add the user to that group

## IAM Policies Inheritance

- a user can be in more than one group, or receive inline policies (directly for the user)
- IAM policies consists of:
  - Version
  - Id: optional identifier to that policy
  - One or more statements
- Statements consists of:
  - Sid: identifier of the statement (optional)
  - Effect: "allow" or "deny"
  - Principal: account/user/role to which this policy applied to
  - Action: list of actions this policy allows or denies
  - Resource: list of resources to which the actions applied to
  - Condition: optional, when this policy is in effect
- Policies can be viewed as a group of permissions, or just one permission. It depends on how the document is set

## IAM Password policy

- strong passwords -> higher security for your account
- minimum password length
- specific characters
- Allow IAM users to change their password
- require user to change password over time
- prevent password reuse
- IAM default has already some restrictions for safety

## MFA - Multi factor authentication

- MFA device -> very useful for root password
- E.g: password + MFA -> successful login
- less likely to have the account leaked
- Virtual MFA device - Google authenticator, Authy
- Universal: YubiKey, other hardwares
- Click on account name, security credentials
- "Assign MFA" -> set up authenticator app

## AWS Access Keys, CLI and SDK

- Options to access AWS:
  - Management Console (protected by password + MFA)
  - AWS CLI - protected by access keys
  - AWS Software Developer Kit (SDW) - protected by access keys
- Access keys are generated by Management Console

### CLI

- Tool used in command-line shell
- Access to the public APIs of AWS
- Develop scripts to interact with AWS

### SDK

- Software Development Kit
- Access and manage AWS Services programmatically
- embedded within your application
- AWS CLI is built on AWS SDF for Python
- CLI has the same authorization as the user who generated the credentials

### Cloudshell

- Alternative to run AWS CLI
- directly on the Console
- Terminal in the Cloud
- The credentials are the same as you are using to log in the Console
- The files will persist in the environment

## IAM Roles

- Services need to perform actions on our behalf
- Similar to user, by it is used by AWS Services
- E.g.: Permissions to a EC2 Instance added by a IAM Role
- Common roles: EC2 Instance Roles, Lambda Function Roles.
- Attach Policies to the role

## IAM Security Tools

- IAM Credential Report - list all users and status of their various credentials
- IAM Access Advisor - show the service permissions granted to a user and when those services were last accessed

### Credential Report

- Generates a CSV
- Information about every account (MFA, last used resources, password last used)

### Access Advisor

- which services were accessed by a user and when
- can use to fine tune the authorization to a user

## IAM Guidelines and Best Practices

- do not use root account except for AWS account setup
- One physical user = one AWS user
- Assign users to groups and assign permissions to groups
- Create Strong password policy
- Use and Enforce MFA
- Create and use Roles for giving permissions to AWS services
- Use access keys for programmatic access
- IAM Credentials Report and IAM Access Manager

## Shared Responsibility Model for IAM

- AWS:
  - Infrastructure
  - Configuration and vulnerability analysis
  - Compliance validation
- You:
  - users, groups, policies, management and monitoring
  - enable MFA on all account
  - rotate keys often
  - Use IAM tools to apply appropriate permissions
  - Analyze access patterns and review permissions
